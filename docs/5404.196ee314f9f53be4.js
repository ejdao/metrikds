"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5404],{5404:(S,y,a)=>{a.r(y),a.d(y,{DietasModule:()=>N});var f=a(7518),I=a(7810),l=a(579),h=a(4650);const m=[{path:"",children:[{path:"jornada-dietas",loadChildren:()=>Promise.all([a.e(7155),a.e(8592),a.e(3523)]).then(a.bind(a,3523)).then(u=>u.JornadaDietasPageModule),data:{title:"Jornada de dietas",authorities:[I.Rb.ADMINISTRADOR,l.a.JORNADA_DIETAS,l.a.JORNADA_DIETAS_EXTERNO]}},{path:"registro-jornada-dietas",loadChildren:()=>a.e(669).then(a.bind(a,669)).then(u=>u.RegistroJornadaDietasModule),data:{title:"Registro jornada de dietas",authorities:[I.Rb.ADMINISTRADOR,l.a.REGISTRO_DIETAS]}}]}];let C=(()=>{class u{}return u.\u0275fac=function(n){return new(n||u)},u.\u0275mod=h.oAB({type:u}),u.\u0275inj=h.cJS({imports:[f.Bz.forChild(m),f.Bz]}),u})();var b=a(4611),O=a(4054);let N=(()=>{class u{}return u.\u0275fac=function(n){return new(n||u)},u.\u0275mod=h.oAB({type:u}),u.\u0275inj=h.cJS({providers:[b.Y,b.x,O.S],imports:[C]}),u})()},4054:(S,y,a)=>{a.d(y,{S:()=>D});var f=a(5861),I=a(3200),l=a(1135),h=a(3905),m=a(8505),C=a(4004);const b=[{value:1,option:"SALIDA NO REPORTADA"},{value:2,option:"FALLECIMIENTO"},{value:3,option:"PROCEDIMIENTO QUIRURGICO"},{value:4,option:"NO LE GUST\xd3"},{value:5,option:"DIETA NO ADECUADA"}];var u=(()=>{return(d=u||(u={}))[d.PENDIENTE=1]="PENDIENTE",d[d.ENTREGADO=9]="ENTREGADO",d[d.DEVUELTO=2]="DEVUELTO",u;var d})();const E=d=>{switch(d){case u.DEVUELTO:return"DEVUELTO";case u.ENTREGADO:return"ENTREGADO";case u.PENDIENTE:return"PENDIENTE"}};var n=a(7810),p=a(4650),s=a(529),v=a(2923);let D=(()=>{class d{constructor(e,t){this._http=e,this._timer=t,this._subject=new l.X({data:[],lastUpdate:null}),this._gruposDietas$=this._subject.asObservable()}entregarDieta(e){return(0,h.z)(this._http.get(`${n.FX.V1.HOSPITALIZACION.DIETAS}/entregar-dieta/${e.id}`).pipe((0,m.b)(t=>{this._subject.value.data.map(i=>{i.id===e.idGrupo&&i.subgrupos.map(c=>{c.dietas.map(r=>{r.id===e.id&&(9===t.estado&&(c.cantidadEntregadas++,e.incluyeDietaFamiliar&&c.cantidadEntregadas++,e.incluyeMerienda&&c.cantidadEntregadas++),2===t.estado&&(c.cantidadDevueltas++,e.incluyeDietaFamiliar&&c.cantidadDevueltas++,e.incluyeMerienda&&c.cantidadDevueltas++),r.estadoDieta=t.estado,r.estadoDietaForHumans=E(t.estado),r.motivoDevolucion=t.motivo,r.motivoDevolucionForHumans=t.motivo?b.filter(o=>o.value===t.motivo)[0].option:"NO DEVUELTO",r.observacionesDevolucion=t.observacion)})})})})))}devolverDieta(e){var t=this;return(0,f.Z)(function*(){const{dieta:i,motivo:c,observacion:r}=e;return(0,h.z)(t._http.get(`${n.FX.V1.HOSPITALIZACION.DIETAS}/devolver-dieta/${i.id}/${c}/${r}`).pipe((0,m.b)(o=>{t._subject.value.data.map(g=>{g.id===i.idGrupo&&g.subgrupos.map(T=>{T.dietas.map(R=>{R.id===i.id&&(9===o.estado&&(T.cantidadEntregadas++,i.incluyeDietaFamiliar&&T.cantidadEntregadas++,i.incluyeMerienda&&T.cantidadEntregadas++),2===o.estado&&(T.cantidadDevueltas++,i.incluyeDietaFamiliar&&T.cantidadDevueltas++,i.incluyeMerienda&&T.cantidadDevueltas++),R.estadoDieta=o.estado,R.estadoDietaForHumans=E(o.estado),R.motivoDevolucion=o.motivo,R.motivoDevolucionForHumans=b.filter(F=>F.value===o.motivo)[0].option,R.observacionesDevolucion=o.observacion)})})})})))})()}confirmarGrupoDieta(e){return(0,h.z)(this._http.get(`${n.FX.V1.HOSPITALIZACION.DIETAS}/confirmar-grupo-dieta/${e.id}`).pipe((0,m.b)(t=>{t&&(this._subject.value.data.map(i=>{i.id===e.id&&(i.estado=2,i.subgrupos.map(c=>{c.estado=2,c.dietas.map(r=>{r.estadoCompra=2})}))}),this._subject.next(this._subject.value))})))}confirmarRecibidoGrupoDieta(e){return(0,h.z)(this._http.get(`${n.FX.V1.HOSPITALIZACION.DIETAS}/confirmar-recibido-grupo-dieta/${e.id}`).pipe((0,m.b)(t=>{t&&(this._subject.value.data.map(i=>{i.id===e.id&&(i.estado=3,i.subgrupos.map(c=>{c.estado=3,c.dietas.map(r=>{r.estadoCompra=3})}))}),this._subject.next(this._subject.value))})))}findAllGruposDietas(e,t){var i=this;return(0,f.Z)(function*(){if(!t&&i._gruposDietas)return i._gruposDietas;const c=(0,h.z)(i._http.get(`${n.FX.V2.HOSPITALIZACION.DIETAS}/fetch-dietas-by-fecha`,{params:{fecha:i._timer.formatDate(e)}}).pipe((0,C.U)(r=>(d=>{const A=[];return d.map(e=>{const t={id:e.id,fecha:new Date(e.fecha),nombreJornada:e.jornada.forHumans,nombreCentro:e.centro.nombre,subgrupos:[],dietas:[],cantidadDietas:0,cantidadSubgrupos:0,estado:e.estado.code},i=((d,A)=>{const e=[];return d.map(t=>{const i=t.dietasExtraordinarias.filter(o=>"MERIENDA"===o.tipo),c=t.dietasExtraordinarias.filter(o=>"DIETA PARA FAMILIAR"===o.tipo),r={fechaDieta:new Date(t.createdAt),mostrarDetallesAdicionales:!1,observaciones:t.observacion,id:t.id,idGrupo:A.id,codigoSubgrupo:t.subgrupo.codigo,estanciaPaciente:t.estancia.id,nombreSubgrupo:t.subgrupo.nombre,nombreCama:t.cama.codigo,nombreCompletoPaciente:t.paciente.nombreCompleto,nombreJornadaDieta:A.nombreJornada,nombreTipoDieta:t.tipo.trim(),nombreConsistenciaDieta:t.consistencia.trim(),nombreCompletoTipoDieta:`${t.tipo.trim()} ${t.consistencia.trim()}`,valorDieta:t.precio,estadoDieta:t.estado.code,estadoDietaForHumans:t.estado.forHumans,estadoCompra:A.estado,motivoDevolucion:t.motivoDevolucion?t.motivoDevolucion.code:null,observacionesDevolucion:t.observacionDevolucion,motivoDevolucionForHumans:t.motivoDevolucion?t.motivoDevolucion.forHumans:null,incluyeMerienda:t.incluyeMerienda,incluyeDietaFamiliar:t.incluyeDietaFamiliar,tipoMerienda:t.tipoMerienda,precioMerienda:i.length?i[0].precio:0,precioDietaFamiliar:c.length?c[0].precio:0,canBeDeleted:t.canBeDeleted};e.push(r)}),e})(e.dietas.filter(r=>!r.consistencia.includes("NO APLICA")&&!r.tipo.includes("NO APLICA")),t);let c=0;i.forEach(r=>{c++,r.incluyeDietaFamiliar&&c++,r.incluyeMerienda&&c++}),t.cantidadDietas=c,t.cantidadSubgrupos=t.subgrupos.length,t.dietas=i,A.push(t)}),A})(r)),(0,m.b)(r=>{i._gruposDietas=r,i._subject.next({data:r,lastUpdate:new Date})})));return c.then(r=>{r.map(o=>i._findAllDietas(o))}),c})()}_findAllDietas(e){const t=e.dietas,i=this._subject.value.data.filter(o=>o.id===e.id)[0],c=(0,I.v1)(t,"codigoSubgrupo","nombreSubgrupo"),r=[];c.map(o=>{r.push({estado:i.estado,nombreSubgrupo:o.name,nombreCentro:i.nombreCentro,nombreJornadaDietas:i.nombreJornada,codigoSubgrupo:o.key,cantidadDietas:this._CDE(o.rows,{})+this._CDE(o.rows,{tipo:"MERI"})+this._CDE(o.rows,{tipo:"FAMI"}),cantidadEntregadas:this._CDE(o.rows,{estado:9})+this._CDE(o.rows,{tipo:"MERI",estado:9})+this._CDE(o.rows,{tipo:"FAMI",estado:9}),cantidadDevueltas:this._CDE(o.rows,{estado:2})+this._CDE(o.rows,{tipo:"MERI",estado:2})+this._CDE(o.rows,{tipo:"FAMI",estado:2}),dietas:o.rows,horaRegistro:o.rows[0].fechaDieta})}),this._subject.value.data.filter(o=>o.id===e.id)[0].subgrupos=r,this._subject.value.data.filter(o=>o.id===e.id)[0].cantidadSubgrupos=r.length,this._subject.next(this._subject.value),this._gruposDietas=this._subject.value.data}_CDE(e,t){let i=0;const{tipo:c,estado:r}=t;if(c){const o="MERI"===c?"incluyeMerienda":"incluyeDietaFamiliar";i=r?e.filter(g=>g[o]&&g.estadoDieta===r).length:e.filter(g=>g[o]).length}else i=r?e.filter(o=>o.estadoDieta===r).length:e.length;return i}deleteDietaById(e){var t=this;return(0,f.Z)(function*(){return(0,h.z)(t._http.delete(`${n.FX.V2.HOSPITALIZACION.DIETAS}/${e}`))})()}observable(){return this._gruposDietas$}}return d.\u0275fac=function(e){return new(e||d)(p.LFG(s.eN),p.LFG(v.fW))},d.\u0275prov=p.Yz7({token:d,factory:d.\u0275fac}),d})()},4611:(S,y,a)=>{a.d(y,{Y:()=>N,x:()=>E});var f=a(5861);class I{constructor(p){this._dietas=p}fetch(p){return this._dietas.fetch(p)}reportar(p){return this._dietas.reportar(p)}}var l=a(3200),h=a(4650),m=a(3905),C=a(7810),b=a(529);let O=(()=>{class n{constructor(s){this._http=s}fetch(s){return(0,m.z)(this._http.get(`${C.FX.V1.HOSPITALIZACION.DIETAS}/dietas-no-recibidas-por-jornada/${s.jornada}`))}reportar(s){return(0,m.z)(this._http.post(`${C.FX.V1.HOSPITALIZACION.DIETAS}/dietas-no-recibidas`,s))}}return n.\u0275fac=function(s){return new(s||n)(h.LFG(b.eN))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),N=(()=>{class n{constructor(s){this._services=s}fetch(s){var v=this;return(0,f.Z)(function*(){const D=new I(v._services);try{const d=yield D.fetch(s);return l.HT.right(d)}catch{return l.HT.left(!1)}})()}insertar(s){var v=this;return(0,f.Z)(function*(){const D=new I(v._services);try{const d=yield D.reportar(s);return l.HT.right(d)}catch{return l.HT.left(!1)}})()}}return n.\u0275fac=function(s){return new(s||n)(h.LFG(O))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac}),n})();var u=a(4054);let E=(()=>{class n{constructor(s){this._services=s}entregarDieta(s){var v=this;return(0,f.Z)(function*(){try{const D=yield v._services.entregarDieta(s);return l.HT.right(D)}catch{return l.HT.left(!1)}})()}devolverDieta(s){var v=this;return(0,f.Z)(function*(){try{const D=yield v._services.devolverDieta(s);return l.HT.right(D)}catch{return l.HT.left(!1)}})()}findAllGruposDietas(s,v=!0){var D=this;return(0,f.Z)(function*(){try{const d=yield D._services.findAllGruposDietas(s,v);return l.HT.right(d)}catch{return l.HT.left(!1)}})()}confirmarRecibidoGrupoDieta(s){var v=this;return(0,f.Z)(function*(){try{const D=yield v._services.confirmarRecibidoGrupoDieta(s);return l.HT.right(D)}catch{return l.HT.left(!1)}})()}confirmarGrupoDieta(s){var v=this;return(0,f.Z)(function*(){try{const D=yield v._services.confirmarGrupoDieta(s);return l.HT.right(D)}catch{return l.HT.left(!1)}})()}deleteDietaById(s){var v=this;return(0,f.Z)(function*(){try{const D=yield v._services.deleteDietaById(s);return l.HT.right(D)}catch{return l.HT.left(!1)}})()}observable(){return this._services.observable()}}return n.\u0275fac=function(s){return new(s||n)(h.LFG(u.S))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac}),n})()}}]);
"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5363],{5891:(b,m,a)=>{a.r(m),a.d(m,{LoginPageModule:()=>S});var d=a(6895),f=a(7518),u=a(5861),g=a(7810),l=a(4006);class F extends l.cw{constructor(){super({context:new l.NI(null,[l.kI.required]),username:new l.NI(null,[l.kI.required]),password:new l.NI(null,[l.kI.required])})}get context(){return this.get("context")}get username(){return this.get("username")}get password(){return this.get("password")}setContext(r){this.context.setValue(r)}get model(){return{context:this.context.value,username:this.username.value,password:this.password.value}}}var t=a(4650),h=a(3200);class x{constructor(r){this._auth=r}execute(r){return this._auth.execute(r)}fetchContexts(){return this._auth.fetchContexts()}}var v=a(3905),C=a(7414),y=a(2843),Z=a(5625),P=a(4004),U=a(2923);let k=(()=>{class n extends U.OE{execute(e){var o=this;return(0,u.Z)(function*(){return(0,v.z)(o._http.post(`${g.FX.V1.AUTH.LOGIN}-with-token-from-v2`,e).pipe((0,C.V)({each:4e3,with:()=>(0,y._)(()=>{})}),(0,Z.X)(3),(0,P.U)(i=>o._transformLoginResponse(i))))})()}fetchContexts(){var e=this;return(0,u.Z)(function*(){return(0,v.z)(e._http.get(`${g.FX.V1.SEGURIDAD.CONTEXTS}`).pipe((0,C.V)({each:4e3,with:()=>(0,y._)(()=>{})}),(0,Z.X)(3)))})()}_transformLoginResponse(e){return e.tokenPrincBack=e.token,e.tokenSecBack=e.tokenV2,e}}return n.\u0275fac=function(){let r;return function(o){return(r||(r=t.n5z(n)))(o||n)}}(),n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),A=(()=>{class n{constructor(e){this._loginUser=e}execute(e){var o=this;return(0,u.Z)(function*(){const i=new x(o._loginUser);try{const s=yield i.execute(e);return h.HT.right(s)}catch{return h.HT.left(!1)}})()}fetchContexts(){var e=this;return(0,u.Z)(function*(){const o=new x(e._loginUser);try{const i=yield o.fetchContexts();return h.HT.right(i)}catch{return h.HT.left(!1)}})()}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(k))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var c=a(4633);function L(n,r){if(1&n&&(t.TgZ(0,"ion-select-option",13),t._uU(1),t.qZA()),2&n){const e=r.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.option," ")}}const T=[{path:"",component:(()=>{class n{constructor(e,o,i,s){this._auth=e,this._alertController=o,this._cd=i,this._router=s,this.centrosSuggestions=[],this.loginForm=new F,this.showPass=!1,this._isAuthenticating=!1}ionViewWillEnter(){var e=this;return(0,u.Z)(function*(){var i;(yield e._auth.fetchContexts()).fold({right:(i=(0,u.Z)(function*(s){const p=s.filter(w=>"DEVELOPMENT"!==w.value);e.centrosSuggestions.push(...p),e.loginForm.setContext(p[0].value),e._cd.markForCheck()}),function(p){return i.apply(this,arguments)}),left:function(){var i=(0,u.Z)(function*(){yield(yield e._alertController.create({header:"Error al consultar contextos",message:"No se obtuvieron los contextos correctamente",buttons:["OK"]})).present()});return function(){return i.apply(this,arguments)}}()})})()}clickOnAuthenticate(){var e=this;return(0,u.Z)(function*(){var i;e.loginForm.valid&&(e._isAuthenticating=!0,e._cd.markForCheck(),(yield e._auth.execute(e.loginForm.model)).fold({right:(i=(0,u.Z)(function*(s){localStorage.setItem(g.aD.authTokenSecBack,s.tokenSecBack),localStorage.setItem(g.aD.authTokenPrincBack,s.tokenPrincBack),localStorage.setItem(g.aD.location,e._getContextName()),localStorage.setItem(g.aD.fullName,s.fullName),e._router.navigate(["home"])}),function(p){return i.apply(this,arguments)}),left:function(){var i=(0,u.Z)(function*(){yield(yield e._alertController.create({header:"Error de autenticaci\xf3n",message:"Usuario y/o contrase\xf1a incorrectas",buttons:["OK"]})).present()});return function(){return i.apply(this,arguments)}}()}),e._isAuthenticating=!1,e._cd.markForCheck())})()}_getContextName(){return this.centrosSuggestions.filter(e=>e.value===this.loginForm.context.value)[0].option.toString()}get isAuthenticating(){return this._isAuthenticating}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(A),t.Y36(c.Br),t.Y36(t.sBO),t.Y36(f.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["gcm-login"]],decls:23,vars:9,consts:[[1,"login-background-image","ion-padding",3,"fullscreen"],[1,"login-container"],[1,"login-content"],["src","assets/images/access-control/logo.png"],[3,"formGroup","ngSubmit"],[2,"padding-top","0px"],["label","Instituci\xf3n","cancelText","Cancelar","label-placement","floating",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["label","Nombre de Usuario","label-placement","floating",3,"formControl"],["label-placement","floating","label","Contrase\xf1a",3,"type","formControl"],["fill","clear",3,"click"],["color","dark","slot","end",1,"pass-eye-icon",3,"name"],["type","submit",1,"bolder",3,"disabled"],[3,"value"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-content",0)(1,"section",1)(2,"div",2),t._UZ(3,"img",3),t.TgZ(4,"div")(5,"b"),t._uU(6,"Eklipse GCM"),t.qZA(),t._UZ(7,"br"),t.TgZ(8,"span"),t._uU(9,"Control de acceso"),t.qZA()(),t.TgZ(10,"form",4),t.NdJ("ngSubmit",function(){return o.clickOnAuthenticate()}),t.TgZ(11,"ion-item",5)(12,"ion-select",6),t.YNc(13,L,2,2,"ion-select-option",7),t.qZA()(),t.TgZ(14,"ion-item"),t._UZ(15,"ion-input",8),t.qZA(),t.TgZ(16,"ion-item"),t._UZ(17,"ion-input",9),t.TgZ(18,"ion-button",10),t.NdJ("click",function(){return o.showPass=!o.showPass}),t._UZ(19,"ion-icon",11),t.qZA()(),t._UZ(20,"br"),t.TgZ(21,"ion-button",12),t._uU(22," INICIAR SESI\xd3N "),t.qZA()()()()()),2&e&&(t.Q6J("fullscreen",!0),t.xp6(10),t.Q6J("formGroup",o.loginForm),t.xp6(2),t.Q6J("formControl",o.loginForm.context),t.xp6(1),t.Q6J("ngForOf",o.centrosSuggestions),t.xp6(2),t.Q6J("formControl",o.loginForm.username),t.xp6(2),t.Q6J("type",o.showPass?"text":"password")("formControl",o.loginForm.password),t.xp6(2),t.Q6J("name",o.showPass?"eye-off-outline":"eye-outline"),t.xp6(2),t.Q6J("disabled",o.isAuthenticating||!o.loginForm.valid))},dependencies:[d.sg,l._Y,l.JJ,l.JL,l.oH,l.sg,c.YG,c.W2,c.gu,c.pK,c.Ie,c.t9,c.n0,c.QI,c.j9],styles:[".login-background-image[_ngcontent-%COMP%]{--background: linear-gradient(105deg, #0aa1ae 60%, #79d5db 60%)}.login-container[_ngcontent-%COMP%]{min-height:calc(100vh - 40px);justify-content:center;align-items:center;text-align:center;display:flex}.login-content[_ngcontent-%COMP%]{text-align:center;white-space:nowrap;background-color:var(--ion-custom-background);box-shadow:#32325d40 0 2px 5px -1px,#0000004d 0 1px 3px -1px;border-radius:10px;padding:16px}.login-content[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{max-height:150px;max-width:260px}form[_ngcontent-%COMP%]{padding:0 10px 10px 0;text-align:center;margin:20px;border-radius:8px}.pass-eye-icon[_ngcontent-%COMP%]{color:var(--ion-text-color)!important}"],changeDetection:0}),n})()}];let I=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[f.Bz.forChild(T),f.Bz]}),n})(),S=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.ez,l.UX,I,c.Pc]}),n})()}}]);